
Функция clevhsInvokePost(Запрос)
	
	Ответ = Новый HTTPСервисОтвет(200);
	
	ИмяСобытия 		= Запрос.ПараметрыURL.Получить("MethodName");
	Параметры 		= Запрос.ПолучитьТелоКакСтроку(); //"[ null, \"оператор\", \"{\r\n  \"Id\": \"98027fdc-068e-4b83-b44c-7688104b48b7\",\r\n  \"ClientIP\": \"fe80__7859_27b4_1eb4_5ea_20\",\r\n  \"DeviceInfo\": {\r\n    \"DeviceId\": \"WIN-O-36CD80756370ACCF3B99775B09F4B878\",\r\n    \"CleanedDeviceId\": \"WIN-36CD80756370ACCF3B99775B09F4B878\",\r\n    \"BatteryStatus\": \"100\",\r\n    \"LastInfoTime\": \"2021-08-10T12:30:24.5445362+03:00\",\r\n    \"UserId\": \"оператор\",\r\n    \"WarehouseId\": \"1\",\r\n    \"DocumentId\": \"new_522666ce-4a75-4acf-869d-6db48f733881\",\r\n    \"DeviceName\": \"windows-client 2012\",\r\n    \"HasCustomName\": false,\r\n    \"DocumentTypeName\": \"ПросмотрСправочников\",\r\n    \"ServerHostedDocument\": false,\r\n    \"DeviceIP\": \"\",\r\n    \"DeviceNameOrIP\": \"windows-client 2012\",\r\n    \"UniqueDescr\": \"оператор, WIN-O-36CD80756370ACCF3B99775B09F4B878\",\r\n    \"ClientVersion\": \"3.3.0.22969\",\r\n    \"EnvironmentVersion\": \"45562\",\r\n    \"ClientVersion\": \"3.3.0.22969\",\r\n    \"EnvironmentVersion\": \"45562\"\r\n  },\r\n  \"ServerAppInstanceId\": \"wh15\",\r\n  \"AddSessionToEventCalls\": true,\r\n  \"ActiveSession\": {\r\n    \"NewProducts\": []\r\n  }\r\n}\" ]";
		
	Попытка
		Если ИмяСобытия = "IBSessionStart" ИЛИ ИмяСобытия = "IBSessionStop" Тогда
			Результат = "";
		ИначеЕсли ИмяСобытия = "TestCallEmptyMethod" Тогда
			Результат = Строка(ТекущаяДата());
		Иначе
			МодульОнлайн = КлеверенсТСД_МодульПовторногоИспользования.ПолучитьВнутреннююОбработку();
			МодульОнлайн.ЭтоWebСервис = Истина;
			
			Если Параметры = "AutoSerialization" Тогда
				Результат = "json";
			ИначеЕсли ТипЗнч(Параметры)=Тип("Строка") И Лев(Параметры,5)="<?xml" Тогда
				ОписаниеОшибки = "# Ошибка: #ONLEX006. Работа через веб-сервис возможна только в json формате. "
				+ "Перезапустите коннектор или службу сервера Mobile SMARTS. Если ошибка остаётся, установите в настройках коннектора формат обмена данными json.";			
				Результат = ОписаниеОшибки;
			Иначе
				Результат = КлеверенсТСД_МодульВебМетодов.REST_API_ВычислитьМетод(ИмяСобытия, Параметры, МодульОнлайн);
			КонецЕсли;
		КонецЕсли;
	Исключение
		ОписаниеОшибки = ОписаниеОшибки();
		Результат = "# Ошибка при выполнении события: "+ ИмяСобытия +", описание ошибки: "+ ОписаниеОшибки;
	КонецПопытки;
	
	Ответ.УстановитьТелоИзСтроки(Результат, КодировкаТекста.UTF8);
	
	Возврат Ответ;
	
КонецФункции

Функция clevhsTest(Запрос)
	
	Ответ = Новый HTTPСервисОтвет(200);
	Ответ.УстановитьТелоИзСтроки("OK", КодировкаТекста.UTF8);
	
	Возврат Ответ;
	
КонецФункции
