///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2023, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

#Область ДляВызоваИзДругихПодсистем

// СтандартныеПодсистемы.ВариантыОтчетов

// Задать настройки формы отчета.
//
// Параметры:
//   Форма - ФормаКлиентскогоПриложения
//         - Неопределено
//   КлючВарианта - Строка
//                - Неопределено
//   Настройки - см. ОтчетыКлиентСервер.НастройкиОтчетаПоУмолчанию
//
Процедура ОпределитьНастройкиФормы(Форма, КлючВарианта, Настройки) Экспорт
	
	Настройки.События.ПриСозданииНаСервере = Истина;
	Настройки.События.ПередФормированиемОтчета = Истина;
	Настройки.РазрешеноИзменятьВарианты = Ложь;
	
КонецПроцедуры

// См. ОтчетыПереопределяемый.ПриСозданииНаСервере.
Процедура ПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка) Экспорт
	
	ПараметрыКомпоновки = КомпоновщикНастроек.ФиксированныеНастройки.ПараметрыДанных;
	ПараметрыКомпоновки.Элементы[0].Использование = Истина;
	СписокОпераций = ПараметрыКомпоновки.Элементы[0].Значение;
	СписокОпераций.Добавить(Перечисления.ОперацииРабочегоМестаКассира.НачалоПродажи);
	СписокОпераций.Добавить(Перечисления.ОперацииРабочегоМестаКассира.НачалоВозврата);
	СписокОпераций.Добавить(Перечисления.ОперацииРабочегоМестаКассира.НачалоВозвратаСкупки);
	СписокОпераций.Добавить(Перечисления.ОперацииРабочегоМестаКассира.НачалоКоррекции);
	СписокОпераций.Добавить(Перечисления.ОперацииРабочегоМестаКассира.НачалоСкупки);
	СписокОпераций.Добавить(Перечисления.ОперацииРабочегоМестаКассира.ОткрытиеОтложенногоЧека);
	
КонецПроцедуры

// Параметры:
//   ФормаОтчета - ФормаКлиентскогоПриложения
//   ДополнительныеПараметры - Структура:
//     * ТекстПредупреждения - Строка
//     * ИмяПараметраХраненияОтказаОтПредупреждения - Строка
//
Процедура ПередФормированиемОтчета(ФормаОтчета, ДополнительныеПараметры) Экспорт
	
	АктуализироватьАварийныеЗавершения();
	ОбщегоНазначенияРМК.ПриКомпоновкеРезультатаОтчетаНезавершенныхДействийСЧеком(ЭтотОбъект);
	
КонецПроцедуры

// Конец СтандартныеПодсистемы.ВариантыОтчетов

#КонецОбласти

#КонецОбласти

#Область ОбработчикиСобытий

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	АктуализироватьАварийныеЗавершения();
	ОбщегоНазначенияРМК.ПриКомпоновкеРезультатаОтчетаНезавершенныхДействийСЧеком(ЭтотОбъект);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура АктуализироватьАварийныеЗавершения()
	
	ПараметрыРМК = Новый Структура();
	ПараметрыРМК.Вставить("ЗапускПриСтарте", Пользователи.ЭтоПолноправныйПользователь());
	ИнтерфейсРМКСлужебный.ВыполнитьАнализИРегистрациюАварийногоЗавершенияЧеков(ПараметрыРМК);
	
КонецПроцедуры

#КонецОбласти

#Иначе
ВызватьИсключение НСтр("ru = 'Недопустимый вызов объекта на клиенте.'");
#КонецЕсли