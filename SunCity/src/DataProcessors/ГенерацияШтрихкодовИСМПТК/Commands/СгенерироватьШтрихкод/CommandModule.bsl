
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	Если ЕстьПравоДоступаКНастройкам() Тогда
		                                                                                                   
		Если СтрНайти(ПараметрыВыполненияКоманды.Источник.ИмяФормы, ОбщегоНазначенияИСМПТКВызовСервера.ИмяДокументаАгрегацияВнеПроизводстваИСЦЭДМ()) = 0 Тогда
			
			Если ПараметрыВыполненияКоманды.Источник.Объект.Упаковки.Количество() > 0 Тогда //Код агрегата уже указан, поддерживается ввод только 1 кода на документ
				ПараметрыВыполнения = Новый Структура();
				ПараметрыВыполнения.Вставить("ФормаГенерации", ПараметрыВыполненияКоманды.Источник);
				Оповещение = Новый ОписаниеОповещения("СгенерироватьНовыйШтрихкодПродолжение", ИнтеграцияИСМПТККлиент, ПараметрыВыполнения);
				ТекстВопроса = НСтр("ru = 'Код агрегата уже указан! Заменить текущее значение?'"); 
				ПоказатьВопрос(Оповещение, ТекстВопроса, РежимДиалогаВопрос.ДаНет);
			Иначе	
				ИнтеграцияИСМПТККлиент.СгенерироватьШтрихкодПослеВопроса(ПараметрыВыполненияКоманды.Источник);
			КонецЕсли;
		Иначе 
			ИнтеграцияИСМПТККлиент.СгенерироватьШтрихкодПослеВопроса(ПараметрыВыполненияКоманды.Источник);
		КонецЕсли;
	Иначе
		ТекстСообщения = РаботаСТекстамиИСМПТККлиентСервер.ТекстСообщенияНедостаточноПравДляОткрытияОбратитесьКАдминистратору();
		ОбщегоНазначенияИСМПТККлиентСерверПереопределяемый.СообщитьПользователю(ТекстСообщения);
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ЕстьПравоДоступаКНастройкам()
	
	Возврат ПравоДоступа("Редактирование", Метаданные.РегистрыСведений.ШтрихкодыSSCCИСМПТК)
		И ПравоДоступа("Изменение", Метаданные.Документы.АгрегацияКодовМаркировкиСУЗИСМПТК)
		И ПравоДоступа("Просмотр", Метаданные.Обработки.ГенерацияШтрихкодовИСМПТК);
	
КонецФункции
